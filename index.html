<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUSIC DNA - Â±ûÊÄßË®∫Êñ≠</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root { --bg: #050505; --card-inner: #121212; --accent-l: #818cf8; --accent-r: #f472b6; --text: #ffffff; --text-dim: #a1a1aa; }
        body { font-family: "Inter", "Hiragino Kaku Gothic ProN", sans-serif; background-color: var(--bg); color: var(--text); margin: 0; overflow-x: hidden; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 60px 0 40px; }
        header h1 { font-size: 2.2rem; letter-spacing: 4px; font-weight: 900; margin: 0; background: linear-gradient(90deg, var(--accent-l), var(--accent-r)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .sub-guide { font-size: 0.8rem; color: var(--text-dim); margin-top: 10px; font-weight: 500; letter-spacing: 1px; }
        #loading-status { text-align: center; font-size: 0.6rem; color: #4ade80; margin-top: 10px; height: 1em; opacity: 0.7; }

        .question-wrapper { display: flex; flex-direction: column; gap: 20px; margin-bottom: 60px; }
        .q-container { background: var(--card-inner); border-radius: 24px; padding: 25px; border: 1px solid #27272a; }
        .q-header { font-size: 0.65rem; color: var(--accent-l); margin-bottom: 12px; display: block; font-weight: 800; letter-spacing: 2px; }
        .choice-group { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .choice-btn { background: #1c1c1f; border: 2px solid #27272a; color: white; padding: 18px 12px; border-radius: 16px; cursor: pointer; font-size: 0.85rem; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); min-height: 90px; display: flex; align-items: center; justify-content: center; line-height: 1.5; text-align: center; font-weight: 500; }
        .choice-btn.active { border-color: var(--accent-l); background: rgba(129, 140, 248, 0.15); box-shadow: 0 0 20px rgba(129, 140, 248, 0.2); transform: scale(0.98); }

        .analyze-btn { width: 100%; max-width: 320px; background: white; color: black; border: none; padding: 22px; border-radius: 50px; font-size: 1.1rem; font-weight: 900; cursor: pointer; display: block; margin: 0 auto 100px; transition: 0.3s; box-shadow: 0 10px 30px rgba(255,255,255,0.1); }
        .analyze-btn:disabled { background: #27272a; color: #52525b; cursor: not-allowed; box-shadow: none; }

        #result-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 1000; overflow-y: auto; padding: 40px 15px; box-sizing: border-box; }
        #capture-area { background: #fff; color: #000; border-radius: 36px; overflow: hidden; width: 100%; max-width: 420px; margin: 0 auto; position: relative; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
        .card-top { background: #000; padding: 35px 20px; text-align: center; color: white; }
        .card-content { padding: 40px 30px; text-align: center; }
        .res-type-label { font-size: 0.7rem; font-weight: 900; color: #9ca3af; letter-spacing: 2px; margin-bottom: 5px; }
        .res-type-badge { font-size: 1.5rem; font-weight: 900; color: #000; margin-bottom: 15px; display: block; }
        .res-title { font-size: 1.2rem; font-weight: 900; background: #000; color: #fff; display: inline-block; padding: 5px 15px; border-radius: 8px; margin-bottom: 20px; }
        
        .best-artist-card { background: #f3f4f6; padding: 25px; border-radius: 28px; margin-bottom: 30px; position: relative; }
        .best-label { font-size: 0.6rem; font-weight: 800; color: #6b7280; letter-spacing: 1px; margin-bottom: 10px; }
        .best-name { font-size: 1.8rem; font-weight: 900; color: #000; margin-bottom: 12px; display: block; line-height: 1.2; }
        .hashtag-container { display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; margin-bottom: 15px; }
        .dna-hashtag { font-size: 0.75rem; font-weight: 800; color: var(--accent-l); }
        
        .yt-button { display: inline-flex; align-items: center; background: #ff0000; color: white; text-decoration: none; padding: 10px 20px; border-radius: 50px; font-size: 0.75rem; font-weight: 800; gap: 6px; }
        
        .other-matches { border-top: 1px solid #e5e7eb; padding-top: 25px; }
        .other-label { font-size: 0.65rem; font-weight: 800; color: #9ca3af; margin-bottom: 15px; }
        .artist-chips { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
        .chip { background: #fff; border: 1.5px solid #000; padding: 6px 14px; border-radius: 50px; font-size: 0.75rem; font-weight: 800; color: #000; }

        .action-btns { width: 100%; max-width: 420px; margin: 25px auto; display: flex; flex-direction: column; gap: 15px; }
        .btn-save { background: linear-gradient(90deg, var(--accent-l), var(--accent-r)); color: white; border: none; padding: 20px; border-radius: 20px; font-weight: 900; cursor: pointer; font-size: 1rem; }
        .btn-retry { text-align: center; color: var(--text-dim); font-size: 0.8rem; cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>MUSIC DNA</h1>
        <p class="sub-guide">„ÅÇ„Å™„Åü„ÅÆÈü≥Ê•ΩÁöÑÈÅ∫‰ºùÂ≠ê„ÇíËß£Êûê„Åó„Åæ„Åô</p>
        <div id="loading-status">Loading Data...</div>
    </header>
    <div class="question-wrapper" id="q-list"></div>
    <button id="analyze-btn" class="analyze-btn" disabled onclick="showResult()">DNA„ÇíËß£Êûê„Åô„Çã</button>
</div>

<div id="result-overlay">
    <div id="capture-area">
        <div class="card-top">
            <div style="font-size: 0.6rem; letter-spacing: 5px; opacity: 0.6;">GENETIC MUSIC ANALYSIS</div>
            <div style="font-size: 1.2rem; font-weight: 900; margin-top: 8px;">RESULT REPORT</div>
        </div>
        <div class="card-content">
            <div class="res-type-label">DNA TYPE</div>
            <div id="res-type" class="res-type-badge">-</div>
            <div id="res-title" class="res-title">-</div>
            
            <div class="best-artist-card">
                <div class="best-label">BEST MATCHING</div>
                <div id="best-name" class="best-name">-</div>
                <div id="hashtag-list" class="hashtag-container"></div>
                <a id="yt-link" href="#" target="_blank" class="yt-button">‚ñ∂ LISTEN ON YouTube</a>
            </div>

            <div class="other-matches">
                <div class="other-label">RELATED ARTISTS</div>
                <div id="other-list" class="artist-chips"></div>
            </div>
            
            <div style="margin-top: 40px; font-size: 0.55rem; color: #9ca3af; font-weight: 700;">#MUSICDNA #Èü≥Ê•ΩË®∫Êñ≠</div>
        </div>
    </div>
    <div class="action-btns">
        <button class="btn-save" onclick="saveAsImage()">üì∏ ÁµêÊûú„ÇíÁîªÂÉè„Å®„Åó„Å¶‰øùÂ≠ò</button>
        <div class="btn-retry" onclick="location.reload()">RE-TRY</div>
    </div>
</div>

<script>
    // ‚Äª„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆURL„Çí„ÅÇ„Å™„Åü„ÅÆ„ÇÇ„ÅÆ„Å´Â∑Æ„ÅóÊõø„Åà„Å¶„Åè„Å†„Åï„ÅÑ
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRRyt_I_8kDlfPnMSxsVSYBcytr3ur76vs7xmF30t01RFQUkAlULzF8P1oLlsFdLcyMZrQCMj3PAANV/pub?output=csv';
    
    // ÂÖ®8Â±ûÊÄß
    const tags = ["energy", "deep", "aesthetic", "skill", "dig", "idol", "loud", "internet"];
    
    const tagDisplay = {
        energy: "#ÁÜ±ÁãÇ", deep: "#Ê∑±„ÅÑÊ≤°ÂÖ•", aesthetic: "#Ê¥óÁ∑¥„Åï„Çå„Åü‰∏ñÁïåË¶≥",
        skill: "#Á≤æÂ∑ß„Å™ÊäÄÂ∑ß", dig: "#Êú™Ë∏è„ÅÆÁô∫Ë¶ã",
        idol: "#„Ç¢„Ç§„Éâ„É´È≠Ç", loud: "#ÁàÜÈü≥‰∏≠ÊØí", internet: "#„Éç„ÉÉ„Éà„Ç∑„Éº„É≥Áô∫"
    };

    const questions = [
        { id:0, a: "Âº∑„ÅÑÈü≥„Åß‰∏ÄÊ∞ó„Å´Ê∞óÊåÅ„Å°„ÇíËß£Êîæ„Åó„Åü„ÅÑ", b: "ÊÑüÊÉÖ„Å´ÂØÑ„ÇäÊ∑ª„Å£„Å¶„Åè„Çå„ÇãÊõ≤„Å´Ë∫´„ÇíÈ†ê„Åë„Åü„ÅÑ", tagsA: ["energy", "loud"], tagsB: ["deep"] },
        { id:1, a: "Â†¥„ÅÆÁÜ±Èáè„Åî„Å®Èü≥Ê•Ω„ÇíÊµ¥„Å≥„Åü„ÅÑ", b: "Èü≥„ÅÆÁæé„Åó„Åï„Å´Èùô„Åã„Å´Êµ∏„Çä„Åü„ÅÑ", tagsA: ["energy", "idol"], tagsB: ["aesthetic"] },
        { id:2, a: "Áü•„Çâ„Å™„ÅÑÈü≥Ê•Ω„Å´Âá∫‰ºö„ÅÜ„Å®„ÉØ„ÇØ„ÉØ„ÇØ„Åô„Çã", b: "Â•Ω„Åç„Å™Èü≥Ê•Ω„ÇíÁπ∞„ÇäËøî„ÅóËÅ¥„ÅèÊñπ„ÅåËêΩ„Å°ÁùÄ„Åè", tagsA: ["dig"], tagsB: ["aesthetic"] },
        { id:3, a: "ÊßãÊàê„ÇÑÂ±ïÈñã„ÅÆÂ∑ß„Åï„Å´„Çæ„ÇØ„ÉÉ„Å®„Åô„Çã", b: "ËÄÉ„ÅàËæº„Åæ„Åö„ÄÅ„Åù„ÅÆÁû¨Èñì„ÅÆÂã¢„ÅÑ„ÅßÊ•Ω„Åó„Åø„Åü„ÅÑ", tagsA: ["skill"], tagsB: ["energy"] },
        { id:4, a: "‰∏Ä„Å§‰∏Ä„Å§„ÅÆÈü≥„ÇÑÊºîÂ•è„ÇíÁ¥∞„Åã„ÅèËÅ¥„Åç„Åü„ÅÑ", b: "ÂÖ®‰Ωì„ÅÆÈõ∞Âõ≤Ê∞ó„ÅåÂøÉÂú∞„Çà„Åë„Çå„Å∞„Åù„Çå„Åß„ÅÑ„ÅÑ", tagsA: ["skill"], tagsB: ["aesthetic"] },
        { id:5, a: "ÊúÄÂàù„ÅÆÊï∞Áßí„ÅßÂÆåÊàêÂ∫¶„ÇíÊÑü„Åò„Åü„ÅÑ", b: "ËÅ¥„ÅçÁµÇ„Çè„Å£„ÅüÂæå„ÅÆ‰ΩôÈüª„ÇíÂ§ß‰∫ã„Å´„Åó„Åü„ÅÑ", tagsA: ["skill"], tagsB: ["aesthetic"] },
        { id:6, a: "ÊÑüÊÉÖ„Åå„ÇÄ„ÅçÂá∫„Åó„ÅÆÊ≠å„Å´ÂÖ±ÊÑü„Åó„Åü„ÅÑ", b: "Ëá™Áî±„Å™Áô∫ÊÉ≥„ÇÑ„Çµ„Ç¶„É≥„Éâ„ÇíÂèñ„ÇäÂÖ•„Çå„ÅüÊõ≤„ÇíËÅ¥„Åç„Åü„ÅÑ", tagsA: ["deep"], tagsB: ["dig", "internet"] },
        { id:7, a: "Ëá™ÂàÜ„ÅÆÊÑüË¶ö„Å´Âà∫„Åï„ÇãÈü≥Ê•Ω„ÇíË¶ã„Å§„Åë„Åü„ÅÑ", b: "Ê¥óÁ∑¥„Åï„Çå„Åü„Çª„É≥„Çπ„ÇíÊÑü„Åò„ÇãÈü≥„Å´ÊÉπ„Åã„Çå„Çã", tagsA: ["dig"], tagsB: ["aesthetic"] },
        { id:8, a: "Êñ∞„Åó„ÅÑÂà∫ÊøÄ„ÇÑÊú™Áü•„ÅÆ„Ç∏„É£„É≥„É´„ÇíÊé¢„Åó„Åü„ÅÑ", b: "ÊºîÂ•è„ÇÑ„Éó„É¨„Ç§„ÅÆÂáÑ„Åï„ÇíÂë≥„Çè„ÅÑ„Åü„ÅÑ", tagsA: ["dig"], tagsB: ["skill"] },
        { id:9, a: "Ê∑±Â§ú„Å´‰∏Ä‰∫∫„ÅßÈùô„Åã„Å´Êµ∏„ÇãÈü≥Ê•Ω", b: "ÊòºÈñì„Å´ËÉå‰∏≠„ÇíÊäº„Åó„Å¶„Åè„Çå„ÇãÈü≥Ê•Ω", tagsA: ["deep"], tagsB: ["energy", "idol"] },
        { id:10, a: "Â∞è„Åï„ÅÑ„É©„Ç§„Éñ„Éè„Ç¶„Çπ„ÅßÊ•Ω„Åó„ÇÄÈü≥Ê•Ω„ÅåÂ•Ω„Åç", b: "Â§ß„Åç„Å™‰∏Ä‰ΩìÊÑü„ÇíÁîü„ÇÄÈü≥Ê•Ω„ÅåÂ•Ω„Åç", tagsA: ["dig", "internet"], tagsB: ["energy", "idol"] },
        { id:11, a: "‰∏ÄË≤´„Åó„ÅüÁæéÊÑèË≠ò„ÇÑ‰∏ñÁïåË¶≥„ÇíÊÑü„Åò„Åü„ÅÑ", b: "‰∫àÊ∏¨„Åß„Åç„Å™„ÅÑÂ±ïÈñã„ÇÑÂ§â„Å™Èü≥„Å´ÊÉπ„Åã„Çå„Çã", tagsA: ["aesthetic", "idol"], tagsB: ["dig", "internet"] },
        { id:12, a: "‰∏ÄÊ∞ó„Å´ÂÖÉÊ∞ó„Çí„ÉÅ„É£„Éº„Ç∏„Åó„Åü„ÅÑ", b: "Èùô„Åã„ÅßÂøÉÂú∞„Çà„ÅÑÊôÇÈñì„ÇíÈÅé„Åî„Åó„Åü„ÅÑ", tagsA: ["energy"], tagsB: ["aesthetic"] },
        { id:13, a: "ÊÑüÊÉÖ„ÇíÁõ¥Êé•Êè∫„Åï„Å∂„Çâ„Çå„ÇãÁû¨Èñì„ÅåÂ§ß‰∫ã", b: "Êõ≤„ÅÆÊßãÊàê„ÇÑÂÆåÊàêÂ∫¶„Å´ÊÑüÂãï„Åó„Åü„ÅÑ", tagsA: ["deep", "internet"], tagsB: ["skill"] },
        { id:14, a: "„Åæ„Å†Áü•„Çâ„Çå„Å¶„ÅÑ„Å™„ÅÑÊÑü„Åò„Åå„Åü„Åæ„Çâ„Å™„ÅÑ", b: "„Åø„Çì„Å™„ÅßÂÖ±Êúâ„Åß„Åç„ÇãÁÜ±„Åï„Åå„Åü„Åæ„Çâ„Å™„ÅÑ", tagsA: ["dig", "internet"], tagsB: ["energy", "idol"] }
    ];

    const titleMap = {
        energy_dig: "Êñ∞ÊôÇ‰ª£„ÅÆÁÜ±ÁãÇ„Éè„É≥„Çø„Éº", energy_aesthetic: "Ëºù„Åè„Çπ„ÉÜ„Éº„Ç∏„ÅÆÁõÆÊíÉËÄÖ",
        energy_skill: "Á≤æÂØÜ„Å´ÁãÇ„ÅÜÊÉÖÁÜ±„ÅÆÊ©üÊßã", energy_deep: "È≠Ç„ÇíÈúá„Çè„Åõ„ÇãÊÉÖÁÜ±„ÅÆ‰ª£ÂºÅËÄÖ",
        dig_aesthetic: "Â¢ÉÁïå„ÇíÊ≠©„ÅèÂØ©ÁæéÂÆ∂", dig_skill: "Êú™Ë∏è„ÅÆÈü≥„ÇíËß£„ÅèËß£ÊûêÂÆò",
        dig_deep: "Êµ∑Â∫ï„ÇíÊºÇ„ÅÜÊÑüÊÉÖ„ÅÆË¶≥Ê∏¨ËÄÖ", aesthetic_skill: "ÂÆåÁíß„Å™‰ΩôÁôΩ„ÅÆË®≠Ë®àÂ£´",
        aesthetic_deep: "ÊúàÂ§ú„Å´Ê≤à„ÇÄÁæéÂ≠¶„ÅÆË©©‰∫∫", skill_deep: "Ê∑±Ê∑µ„ÅÆÈü≥ÈüøÂì≤Â≠¶ËÄÖ",
        energy_idol: "ÁÜ±ÁãÇ„ÇíÂâµ„ÇãÂøúÊè¥„ÅÆ„Éó„É≠", loud_energy: "ÈºìËÜú„ÇíÊè∫„Çâ„ÅôË°ùÂãï„ÅÆÂ°ä",
        internet_dig: "„Éç„ÉÉ„Éà„ÅÆÊ∑±Ê∑µ„ÇíÊ≠©„ÅèÊé¢Ê±ÇËÄÖ", internet_deep: "„Éá„Ç∏„Çø„É´„Å´Ê≤à„ÇÄÂèôÊÉÖÂÆ∂"
    };

    let artistMaster = [];
    let answers = new Array(questions.length).fill(null);

    async function init() {
        try {
            const res = await fetch(SHEET_URL);
            const csvText = await res.text();
            const rows = csvText.split(/\r?\n/).slice(1);
            artistMaster = rows.map(row => {
                const cols = row.split(',').map(c => c.trim().replace(/^"|"$/g, ''));
                if (cols.length < 2) return null;
                // A:ÂêçÂâç B:E C:De D:A E:S F:Di G:Id H:Lo I:In
                return {
                    name: cols[0],
                    matrix: {
                        energy: cols[1]==='‚óé', deep: cols[2]==='‚óé', aesthetic: cols[3]==='‚óé',
                        skill: cols[4]==='‚óé', dig: cols[5]==='‚óé', idol: cols[6]==='‚óé', 
                        loud: cols[7]==='‚óé', internet: cols[8]==='‚óé'
                    }
                };
            }).filter(a => a && a.name);
            document.getElementById('loading-status').innerText = `‚úÖ ${artistMaster.length} Artists Synced`;
        } catch(e) {
            document.getElementById('loading-status').innerText = `‚ùå Sync Error`;
        }
        renderQuestions();
    }

    function renderQuestions() {
        const list = document.getElementById('q-list');
        const shuffled = [...questions].sort(() => Math.random() - 0.5);
        shuffled.forEach((q, i) => {
            const div = document.createElement('div');
            div.className = 'q-container';
            div.innerHTML = `<span class="q-header">ANALYSIS NO.${String(i+1).padStart(2,'0')}</span><div class="choice-group">
                <button class="choice-btn" onclick="select(${q.id},'A',this)">${q.a}</button>
                <button class="choice-btn" onclick="select(${q.id},'B',this)">${q.b}</button>
            </div>`;
            list.appendChild(div);
        });
    }

    function select(id, type, btn) {
        answers[id] = type;
        Array.from(btn.parentElement.children).forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if (!answers.includes(null)) document.getElementById('analyze-btn').disabled = false;
    }

    function showResult() {
        const userScores = { energy:0, deep:0, aesthetic:0, skill:0, dig:0, idol:0, loud:0, internet:0 };
        answers.forEach((ans, i) => {
            const targetTags = ans === 'A' ? questions[i].tagsA : questions[i].tagsB;
            targetTags.forEach(t => userScores[t]++);
        });

        const sortedTypes = Object.entries(userScores).sort((a,b) => b[1] - a[1]);
        const t1 = sortedTypes[0][0], t2 = sortedTypes[1][0];
        
        document.getElementById('res-type').innerText = `${t1.toUpperCase()} √ó ${t2.toUpperCase()}`;
        document.getElementById('res-title').innerText = titleMap[`${t1}_${t2}`] || titleMap[`${t2}_${t1}`] || "Èü≥Ê•Ω„ÅÆÊé¢Ê±ÇËÄÖ";

        // „Éû„Éà„É™„ÉÉ„ÇØ„ÇπÂà§ÂÆö
        let list = artistMaster.map(artist => {
            let totalPts = 0;
            tags.forEach(t => {
                if (artist.matrix[t]) totalPts += userScores[t];
            });
            return { ...artist, score: totalPts };
        });

        list = list.sort(() => Math.random() - 0.5).sort((a,b) => b.score - a.score);
        const best = list[0];
        const others = list.slice(1, 6);

        document.getElementById('best-name').innerText = best.name;
        document.getElementById('yt-link').href = `https://www.youtube.com/results?search_query=${encodeURIComponent(best.name)}`;
        
        // „Éè„ÉÉ„Ç∑„É•„Çø„Ç∞Ë°®Á§∫
        const hashtags = tags.filter(t => best.matrix[t]).map(t => tagDisplay[t]);
        document.getElementById('hashtag-list').innerHTML = hashtags.map(h => `<span class="dna-hashtag">${h}</span>`).join('');
        
        document.getElementById('other-list').innerHTML = others.map(a => `<div class="chip">${a.name}</div>`).join('');

        document.getElementById('result-overlay').style.display = 'block';
        window.scrollTo(0,0);
    }

    async function saveAsImage() {
        const area = document.getElementById('capture-area');
        const canvas = await html2canvas(area, { backgroundColor: '#000', scale: 3 });
        const link = document.createElement('a');
        link.download = 'MUSIC_DNA_RESULT.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
    }

    init();
</script>
</body>
</html>
